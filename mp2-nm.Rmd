---
title: "Mini Project 2"
author: "Nukhbah Majid"
date: "3/18/2019"
output: 
  html_document:
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading the data


```{r, message=FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(plyr)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r}
fltr_cand <- candidates %>%
  filter(cand_office_state == "MA", cand_election_yr == "2012", cand_party_affiliation == "DEM" | cand_party_affiliation == "REP") %>%
  inner_join(contributions, by = "cand_id") %>%
  filter(transaction_type == "24A" | transaction_type == "24E", 
         transaction_pgi == "G" | transaction_pgi == "G2012") 
```

## Filter according to party affiliation:

The `REP` data set:

```{r}
rep_data <- fltr_cand %>%
  filter(cand_party_affiliation == "REP")
```


The `DEM` data set: 

```{r}
dem_data <- fltr_cand %>%
  filter(cand_party_affiliation == "DEM")
```


```{r}
num_dem <- dem_data %>%
  summarize(n_distinct(cand_id))

num_rep <- rep_data %>%
  summarize(n_distinct(cand_id))

num_type_elections <- fltr_cand %>%
  summarize(n_distinct(transaction_pgi))
```



Renaming `G2012` entries to `G` as they mean the same thing since the year is fixed as `2012`

```{r}
fltr_cand$transaction_pgi <- revalue(fltr_cand$transaction_pgi, c("G2012" = "G"))
```

Detach the plyr package: 

```{r}
detach(package:plyr)
```

Rearrange the data in the table so that contributions that are greater in magnitude are on the top: 

```{r}
candOrdered <- fltr_cand %>%
  group_by(cand_name) %>%
  summarize(total_given = sum(transaction_amt)) %>%
  arrange(desc(total_given))
```

Make a function so that you could do the same for *all* the candidates - Democrats & Republicans.Store all the *unique* candidate names in the data frame as a vector and map the function that produces the bar graph on all of them: 

```{r fig.width=12, fig.height=11}
candNamesVector <- unique(candOrdered$cand_name)
candidatesDF <- data.frame(candNamesVector)

eachCandData <- function(cand_name_arg) {
  fltr_cand %>%
    filter(cand_name == cand_name_arg) %>%
    group_by(transaction_type, cand_name, cand_party_affiliation) %>%
    summarize(total = sum(transaction_amt))
}

allCandidates <- map_df(candidatesDF$candNamesVector, eachCandData)

#facet_wrap arranges alphabetically by default, so in order to graph the plot in the correct order of the names we have to do this
allCandidates$cand_name <- factor(allCandidates$cand_name, levels = candOrdered$cand_name)
```

Make bar graphs: 

```{r}
##making a bar graph to plot the summarise data ----
colorVector <- c("grey","green")
colorVectorAl <- c("grey", "red")

ggplot(allCandidates, aes(x = transaction_type, y = total/1000000, fill = transaction_type)) +
  geom_bar(stat = "identity", width = 0.5) +
  scale_fill_manual(values = colorVector)+
  scale_y_continuous(expand = c(0, 0), limits = c(0, 5))+
  scale_x_discrete(labels = c("24E" = "Money\n Supporting", "24A" = "Money\n Opposing")) +
  facet_wrap(~as.factor(cand_party_affiliation)) +
  labs(title = "Total Donations by the Committees 'For' and 'Against' Candidates of the Two Major Parties",
       x = "Party Affiliation", 
       y = "Amount donated (in millions/$)") +
  theme(legend.position = "none")
  
  
```

```{r}
## plotting data graph for each
colorVector2 <- c("blue", "grey")
ggplot(allCandidates, aes(x = transaction_type, y = total, fill = transaction_type)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = colorVector2)+
  scale_y_continuous(expand = c(0, 0))+
  facet_wrap(~as.factor(cand_name)) 
```






